# Author: Serena Yeoh
#
# Disclaimer:
# This playbook was written based on my self-learning and may not follow certain
# best practices or work properly in your environment. Use it at your own risk.
#

# Configure primary control plane
- name: Create primary control plane
  hosts: primary_control_plane[0]
  gather_facts: no

  roles:
    - kubernetes/control-plane-primary
    - cni-calico

# Configure sencondary control planes
- name: Join secondary control planes
  hosts: secondary_control_planes
  gather_facts: no

  roles:
    - kubernetes/control-plane-other

# Uncomment this to have worker nodes.
# - name: Join worker nodes
#   hosts: kubernetes_nodes
#   gather_facts: no

#   roles:
#     - kubernetes/worker-node

  # Create checkpoints for safety reasons. You can delete the checkpoints later.
- hosts: kubernetes_cluster
  gather_facts: no

  tasks:
    - import_tasks: ./tasks/task-checkpoint-vm.yaml
      vars:
        checkpoint_name: "Kubernetes configured."
      when: _checkpoint