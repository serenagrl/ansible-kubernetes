- name: Provision Virtual Machines
  hosts: load_balancers
  gather_facts: no

  pre_tasks:
    - import_tasks: ./tasks/task-create-working-directory.yaml

  roles:
    - role: vm-ubuntu
      specs:
        ram_size: 2GB
        min_ram_size: 2GB
        disk_size: 127GB
        v_cpu: 2

    - role: infrastructure/haproxy

  # Create checkpoints for safety reasons. You can delete the checkpoints later.
  post_tasks:
    - import_tasks: ./tasks/task-checkpoint-vm.yaml
      vars:
        checkpoint_name: "Haproxy configured."
      when: _checkpoint
