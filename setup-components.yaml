- name: Install Kubernetes add-on components
  hosts: primary_control_plane[0]
  become_user: "{{ _kube.user }}"
  gather_facts: no

  tasks:
    - include_role:
        name: "{{ role }}"
      loop_control:
        loop_var: role
      loop: "{{ _kube.add_ons }}"
  
# Create checkpoints for safety reasons. You can delete the checkpoints later.
- hosts: kubernetes_cluster
  gather_facts: no

  tasks:
    - import_tasks: ./tasks/task-checkpoint-vm.yaml
      vars:
        checkpoint_name: "Components installed."
      when: _checkpoint
