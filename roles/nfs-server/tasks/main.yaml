# Author: Serena Yeoh
#
# Disclaimer:
# This playbook was written based on my self-learning and may not follow certain
# best practices or work properly in your environment. Use it at your own risk.
#
- name: Installing nfs server package
  apt:
    pkg:
      - nfs-server
    state: latest
    update_cache: true

- name: Create shared directory
  file:
    path: "{{ shared }}"
    state: directory
    mode: '0777'

- name: Export shared directory to kubernetes cluster nodes
  lineinfile:
    path: /etc/exports
    line: "{{ shared }} {{ hostvars[item]['ansible_host'] }}(rw,no_subtree_check,no_root_squash)"
  loop: "{{ groups[share_to] }}"

- name: Enable nfs
  shell: |
          sudo systemctl enable --now nfs-server
          sudo exportfs -ar

