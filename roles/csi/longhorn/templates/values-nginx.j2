{% if not kube.allow_scheduling %}
defaultSettings:
  taintToleration: node-role.kubernetes.io/control-plane=:NoSchedule
{% endif %}

longhornManager:
  log:
    format: {{ longhorn.log_format }}

{% if not kube.allow_scheduling %}
  tolerations:
    - effect: NoSchedule
      key: node-role.kubernetes.io/control-plane
      operator: Exists
  nodeSelector:
    node-role.kubernetes.io/control-plane:
{% endif %}

{% if not kube.allow_scheduling %}
longhornDriver:
  tolerations:
    - effect: NoSchedule
      key: node-role.kubernetes.io/control-plane
      operator: Exists
  nodeSelector:
    node-role.kubernetes.io/control-plane:
{% endif %}

longhornUI:
  replicas: 2
{% if not kube.allow_scheduling %}
  tolerations:
    - effect: NoSchedule
      key: node-role.kubernetes.io/control-plane
      operator: Exists
  nodeSelector:
    node-role.kubernetes.io/control-plane:
{% endif %}

ingress:
  enabled: true
  ingressClassName: {{ ingress_name }}
  host: {{ ingress_host }}

  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /$2

  secureBackends: true
  path: /longhorn(/|$)(.*)

metrics:
  serviceMonitor:
    enabled: {{longhorn.prometheus }}