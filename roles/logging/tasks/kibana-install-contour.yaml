- name: Installing kibana
  vars:
    version: "{% if kibana_version is defined and kibana_version and kibana_version != 'latest' %}{{ kibana_version }}{% endif %}"
  kubernetes.core.helm:
    name: kibana
    namespace: logging
    atomic: yes
    chart_repo_url: "https://helm.elastic.co"
    chart_ref: kibana
    chart_version: "{{ version }}"
    create_namespace: yes
    values: "{{ CONTOUR_KIBANA_VALUES_FILE }}"
    timeout: 10m0s
    wait: yes

- include_tasks: ./tasks/task-create-contour-httpproxy.yaml
  vars:
    name: kibana-httpproxy
    namespace: logging
    definition: "{{ INGRESS_CONTOUR_TEMPLATE }}"