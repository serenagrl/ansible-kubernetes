# Author: Serena Yeoh
#
# Disclaimer:
# This playbook was written based on my self-learning and may not follow certain
# best practices or work properly in your environment. Use it at your own risk.
#
- include_vars: ../../vars/main.yaml

- name: Installing nfs client package
  apt:
    pkg:
      - nfs-common
    state: latest
    update_cache: true

- delegate_to: "{{ groups['nfs_server'][0] }}"
  become_user: root
  block:
    - name: Export shared directory to kubernetes cluster nodes
      lineinfile:
        path: /etc/exports
        line: "{{ shared }} {{ ansible_host }}(rw,no_subtree_check,no_root_squash)"

    - name: Enable nfs
      shell: |
              sudo exportfs -ar